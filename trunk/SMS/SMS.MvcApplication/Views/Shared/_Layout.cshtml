@using SMS.Common.Constant
@using SMS.Common.Session
@using SMS.Common
@using SMS.MvcApplication.Models
@using Core.Common
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewBag.Title - Shop management system</title>
    <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <meta name="viewport" content="width=device-width" />
    @Styles.Render("~/Content/themes/base/css")
    <link href="~/Content/themes/@ConfigReader.CurrentTheme/jquery-ui.css" rel="stylesheet" />
    <link href="~/Content/themes/@ConfigReader.CurrentTheme/jquery.ui.theme.css" rel="stylesheet" />
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryui")
    <script type="text/javascript" src="~/Scripts/labelController.js"></script>
    <script type="text/javascript">
        var labelDictionary = @Html.Raw(Json.Encode(LabelDictionary));
        $(document).ready(function() {
            var labelController = new LabelController(labelDictionary, '#page-label-multi-edit', '#editLabelPopup', 
                '@Url.Action("GetAllPageLabel", "Home", new { area = "" })', '@Url.Action("MultiEditPageLabel", "Home", new { area = "" })');
            labelController.ScanElements();
            @if (SmsSystem.UserContext.IsSystemAdmin)
            {
                <text>
            labelController.BuildEditControl(@PageID);
                </text>
            }
        });
    </script>
</head>
<body>
    @Html.Partial("EditLabelPopup", new PopupModel { PopupID = "editLabelPopup", PopupTitle = "Edit Labels" })
    @Html.Partial("PrintInvoicePreview", new PopupModel { PopupID = "printPreviewPopup", PopupTitle = "Print Preview" })

    <div class="ui-helper-clearfix">
        <div id="leftmenu">
            <div>
                <div id="logo">
                    <a href="@Url.Action("Index", "Home")"><img src="~/Images/logo.jpg" alt="logo"/></a>
                </div>
                <nav class="border-bottom">
                    <ul id="menu">
                        @foreach (var pageMenu in PageMenus.Where(x => x.GroupName == ConstPageMenuGroupName.MainMenu))
                        {
                            var page = AccessiblePagesForUser.FirstOrDefault(x => x.ID == pageMenu.PageID);

                            if (page == null) { continue; }

                            if (page.Area.IsNullOrEmpty() && page.Controller.IsNullOrEmpty())
                            {
                                <li><a href="@page.Action">@page.Title</a></li>
                            }
                            else
                            {
                                <li>@Html.ActionLink(@page.Title, @page.Action, @page.Controller, new { area = @page.Area }, null)</li>
                            }
                        }
                    </ul>
                </nav>
                <ul id="user">
                    @if (SmsSystem.UserContext.IsSystemAdmin)
                    {
                        <li><a href="#" id="page-label-multi-edit">Edit Label</a></li>
                    }
                    @if (Request.IsAuthenticated && SmsSystem.UserContext.UserID != 0)
                    {
                        <li>@Html.ActionLink("Log out", "Logoff", "Account", new { area = "" }, null)</li>
                    }
                </ul>
                <ul id="language">
                    
                    @{
                        var classVN = "";
                        var classEN = "";
                        if (SmsSystem.Language == Language.English)
                        {
                            classEN = "class=\"hide\"";
                        }
                        if (SmsSystem.Language == Language.Vietnamese)
                        {
                            classVN = "class=\"hide\"";
                        }
                    }
                    
                    <li @Html.Raw(classVN)><a href="#" id="change-language-vn"><img src="~/Images/flag-vn.png" alt="vn"/> <span data-globalLabelID="lblLanguageVN">Vietnamese</span></a></li>
                    <li @Html.Raw(classEN)><a href="#" id="change-language-en"><img src="~/Images/flag-uk.png" alt="vn"/> <span data-globalLabelID="lblLanguageEN">English</span></a></li>
                </ul> 

                <script type="text/javascript">
                    $('#change-language-vn').click(function () {
                        changeLanguage(@((int)Language.Vietnamese));
                        return false;
                    });
    
                    $('#change-language-en').click(function () {
                        changeLanguage(@((int)Language.English));
                        return false;
                    });

                    function changeLanguage(id) {
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("ChangeLanguage", "Home", new { area = "" })',
                            data: { language: id }
                        }).done(function (result) {
                            if(result.Success)
                                location.reload();
                        });
                    }
                </script>
            </div>
        </div>
        <div id="leftmenuExpander">
            <a href="#" id="expander" class="expanded">&lt;</a>
        </div>
        <div id="body" class="border-left">
            @if (ViewContext.RouteData.DataTokens["area"] != null && ViewContext.RouteData.DataTokens["area"].ToString() == "Data")
            {
                <div id="admin-menu" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
                    <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
                        @foreach (var pageMenu in PageMenus.Where(x => x.GroupName == ConstPageMenuGroupName.DataTabMenu))
                        {
                            var page = AccessiblePagesForUser.FirstOrDefault(x => x.ID == pageMenu.PageID);

                            if (page == null) { continue; }

                            var selectedClass = ViewContext.RouteData.Values["controller"].ToString() == page.Controller
                                                    ? "ui-tabs-active ui-state-active"
                                                    : "";
                            
                            if (page.Area.IsNullOrEmpty() && page.Controller.IsNullOrEmpty())
                            {
                                <li class="ui-state-default ui-corner-top @selectedClass">
                                    <a href="@page.Action" class="ui-tabs-anchor">@page.Title</a>
                                </li>
                            }
                            else
                            {
                                <li class="ui-state-default ui-corner-top @Html.Raw(selectedClass)">
                                    @Html.ActionLink(@page.Title, @page.Action, @page.Controller, new { area = @page.Area }, new { @class = "ui-tabs-anchor" })
                                </li>
                            }
                        }
                    </ul>   
                </div>
                <script type="text/javascript" src="@Url.Content("~/Scripts/admin-function.js")"></script>
                <script type="text/javascript">
                    $(document).ready(function() {
                        $('#admin-menu li').hover(function() {
                            $(this).addClass('ui-state-hover');
                        }, function() {
                            $(this).removeClass('ui-state-hover');
                        });
                    });
                </script>
            }
            @if (ViewContext.RouteData.DataTokens["area"] != null && ViewContext.RouteData.DataTokens["area"].ToString() == "Administration")
            {
                <div id="config-menu" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
                    <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
                        @foreach (var pageMenu in PageMenus.Where(x => x.GroupName == ConstPageMenuGroupName.AdminTabMenu))
                        {
                            var page = AccessiblePagesForUser.FirstOrDefault(x => x.ID == pageMenu.PageID);

                            if (page == null) { continue; }

                            var selectedClass = ViewContext.RouteData.Values["controller"].ToString() == page.Controller
                                                    ? "ui-tabs-active ui-state-active"
                                                    : "";
                            
                            if (page.Area.IsNullOrEmpty() && page.Controller.IsNullOrEmpty())
                            {
                                <li class="ui-state-default ui-corner-top @selectedClass">
                                    <a href="@page.Action" class="ui-tabs-anchor">@page.Title</a>
                                </li>
                            }
                            else
                            {
                                <li class="ui-state-default ui-corner-top @Html.Raw(selectedClass)">
                                    @Html.ActionLink(@page.Title, @page.Action, @page.Controller, new { area = @page.Area }, new { @class = "ui-tabs-anchor" })
                                </li>
                            }
                        }
                    </ul>   
                </div>
                <script type="text/javascript" src="@Url.Content("~/Scripts/admin-function.js")"></script>
                <script type="text/javascript">
                    $(document).ready(function() {
                        $('#config-menu li').hover(function() {
                            $(this).addClass('ui-state-hover');
                        }, function() {
                            $(this).removeClass('ui-state-hover');
                        });
                    });
                </script>
            }
            @RenderBody()
        </div>
    </div>

    @*<footer id="footer">
        &copy; @DateTime.Now.Year - My ASP.NET MVC Application
    </footer>*@
    @Html.Partial("MessagePopup")
    @Html.Partial("AjaxLoader")
    @RenderSection("scripts", required: false)
</body>
</html>
