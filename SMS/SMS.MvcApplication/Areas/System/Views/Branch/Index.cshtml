@using SMS.Common.Session
@using SMS.Data.Dtos
@model SMS.MvcApplication.Models.AdminModel<BranchDto>
@{
    ViewBag.Title = "Index";
}

<script id="record-tmpl" type="text/x-jquery-tmpl">
    <tr class="admin-record-detail">
        <td colspan="6">
            <div class="detail" style="display: none;">
                <div class="row">
                    <div class="three columns right">
                        VN Name
                    </div>
                    <div class="three columns">
                        <input type="text" name="vnName" value="${VNName}" id="vnName-${ID}" />
                    </div>
                    <div class="three columns right">
                        EN Name
                    </div>
                    <div class="three columns">
                        <input type="text" name="enName" value="${ENName}" id="enName-${ID}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="three columns right">
                        Currency
                    </div>
                    <div class="three columns">
                        <select name="currency" id="currency-${ID}">

                        </select>
                    </div>
                    
                </div>
                <div class="row">
                    <div class="three columns right">
                        Enable Service Fee
                    </div>
                    <div class="three columns">
                        {{if UseServiceFee }}
                        <input type="checkbox" name="useServiceFee" checked id="useServiceFee-${ID}"/>
                        {{else}}
                        <input type="checkbox" name="useServiceFee" id="useServiceFee-${ID}"/>
                        {{/if}}
                    </div>
                    <div class="three columns right">
                        Service Fee
                    </div>
                    <div class="three columns">
                        <input type="text" name="serviceFee" value="${ServiceFee}" id="serviceFee-${ID}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="three columns right">
                        Enabled
                    </div>
                    <div class="three columns">
                        {{if Enabled }}
                        <input type="checkbox" name="enabled" checked id="enabled-${ID}"/>
                        {{else}}
                        <input type="checkbox" name="enabled" id="enabled-${ID}"/>
                        {{/if}}
                    </div>
                    <div class="three columns right">
                        SEQ
                    </div>
                    <div class="three columns">
                        <input type="text" name="seq" value="${SEQ}" id="seq-${ID}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="eleven columns right">
                        <input type="button" id="save-${ID}" value="Save" />
                        <input type="button" id="cancel-${ID}" value="Cancel" />
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>

<div id="content">
    <div class="row">
        <h4 class="admin-page-title">Maintain Branch</h4>
    </div>

    @Html.Partial("Search", Model.PagingInfo)

    <div class="row">
        <table id="record-table" class="no-border">
            <colgroup>
                <col style="width: 75px;" />
                <col style="width: 60px;" />
                <col />
                <col style="width: 200px;" />
                <col style="width: 110px;" />
                <col style="width: 75px;" />
            </colgroup>
            <thead>
                <tr>
                    <th></th>
                    <th>No</th>
                    <th>VN Name/EN Name</th>
                    <th>Service Fee</th>
                    <th>Enabled</th>
                    <th>SEQ</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var dto in Model.ListRecord)
                {
                    var altClass = Model.ListRecord.IndexOf(dto) % 2 != 0 ? "alt" : "";
                    <tr class="@altClass" data-id="@dto.ID">
                        <td>
                            <a href="#" class="del-record" data-id="@dto.ID"><img src="~/Images/IconControls/delete-icon.png" alt="delete record" /></a>
                            <a href="#" class="edit-record" data-id="@dto.ID"><img src="~/Images/IconControls/edit-icon.png" alt="edit record" /></a>
                        </td>
                        <td>@Html.Raw(Model.ListRecord.IndexOf(dto) + 1)</td>
                        <td>@dto.VNName/@dto.ENName</td>
                        <td>
                            @if (dto.UseServiceFee)
                            {
                                @dto.ServiceFee
                            }
                            else
                            {
                                Html.Raw("-");
                            }
                        </td>
                        <td>@dto.Enable</td>
                        <td>@dto.SEQ</td>
                    </tr>
                }
                
            </tbody>
            <tfoot>
                <tr>
                    <td class="center"><a href="#" id="addRecord"><img src="~/Images/IconControls/add-icon.png" alt="add record" /></a></td>
                    <td colspan="5"></td>
                </tr>
            </tfoot>
        </table>

        @Html.Partial("Paging", Model.PagingInfo)

        <script type="text/javascript">
            $(document).ready(function () {
                var addUrl = '@Url.Action("GetSchemaForAdd")';
                var editUrl = '@Url.Action("GetDataForEdit")';
                var saveUrl = '@Url.Action("SaveData")';
                var deleteUrl = '@Url.Action("DeleteData")';
                
                var adminfunc = new AdminFunction(addUrl, editUrl, saveUrl, getAreaForSave, deleteUrl, 'Warning', 'Delete this record?');
                adminfunc.bind();
            });

            function getAreaForSave(recordID) {
                var roles = Array();

                $('#assignedRoles-' + recordID + ' option').each(function (idx, e) {
                    roles.push({ ID: $(e).val() });
                });

                var data = {
                    ID: recordID,
                    Username: $('#username-' + recordID).val(),
                    Password: $('#password-' + recordID).val(),
                    Displayname: $('#displayname-' + recordID).val(),
                    @if (SmsSystem.UserContext.IsSystemAdmin)
                    {
                        <text>
                    IsSystemAdmin: $('#systemAdmin-' + recordID).prop('checked'),
                        </text>
                    }
                    IsLockedOut: $('#locked-' + recordID).prop('checked'),
                    Roles: roles
                };
                return data;
            }
        </script>
    </div>
</div>
