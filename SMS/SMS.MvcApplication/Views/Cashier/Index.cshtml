@using SMS.Data.Dtos
@using SMS.MvcApplication.Models
@using SMS.Common.Constant
@model CashierModel
@{
    ViewBag.Title = "Index";
}
<link rel="stylesheet" type="text/css" href="~/Content/css/split-pane.css" />
<script type="text/javascript" src="~/Scripts/split-pane.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.validate.js"></script>
<script id="pdt-tmpl" type="text/x-jquery-tmpl">
    <tr>
        <td>${idx}</td>
        <td>${VNName}</td>
        <td class="right">${Quantity}</td>
        <td>${UnitID}</td>
        <td class="right">${Price}</td>
        <td class="right">${Price * Quantity}</td>
        <td>
            <input type="text" name="remarks${No}" class="remarksInput" /></td>
        <td class="center">X</td>
    </tr>
</script>
<script id="table-tmpl" type="text/x-jquery-tmpl">
    {{each(idx) ListTable}}
        {{if idx % @ConstStyle.GridNumber == 0}}
        <div class='row'>
        {{/if}}
        <div class="one column">
            <input type="button" value="${VNName}" />
        </div>
            
        {{if idx == $data.ListTable.length || idx % @ConstStyle.GridNumber == @ConstStyle.GridNumber - 1}}
        </div>
        {{/if}}
    {{/each}}
</script>
<div id="cashier" class="split-pane horizontal-percent">
    <div id="tablelist" class="split-pane-component">
        <ul>
            @foreach (var areaDto in Model.ListArea)
            {
                <li><a href="#area-@areaDto.Id">@areaDto.VNName</a></li>
            }

        </ul>
        @foreach (var areaDto in Model.ListArea)
        {
            <div id="area-@areaDto.Id">
            </div>
        }
        @*<div id="tabs-1">
            <h5>Area 1</h5>

             @for (var i = 0; i < Model.ListTable.Count; i++)
            {
                if (i % ConstStyle.GridNumber == 0)
                {
                @Html.Raw("<div class='row'>")
                }
    
                <div class="one column">
                    <input type="button" value="@Model.ListTable[i].VNName" />
                </div>
    
                if (i == Model.ListTable.Count - 1 || i % ConstStyle.GridNumber == ConstStyle.GridNumber - 1)
                {
                @Html.Raw("</div>")
                }
            }
        </div>
        <div id="tabs-2">
            <h5>Area 2</h5>

        </div>
        <div id="tabs-3">
            <h5>Area 3</h5>

        </div>*@
    </div>

    <div class="split-pane-divider"></div>

    <div id="tableorder" class="split-pane-component">
        <div class="row">
            <div class="two columns">Table name</div>
            <div class="four columns">User: Son Nguyen. Date: 11/04/2014 18:00</div>
        </div>
        <div class="row">
            <table id="order">
                <colgroup>
                    <col class="col1" />
                    <col class="col2" />
                    <col class="col3" />
                    <col class="col4" />
                    <col class="col5" />
                    <col class="col6" />
                    <col class="col7" />
                    <col class="col8" />
                </colgroup>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Unit</th>
                        <th>Price</th>
                        <th>Amount</th>
                        <th>Remarks</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody class="tbContent">
                    <tr>
                        <td>1</td>
                        <td>Cơm gà</td>
                        <td class="right">1</td>
                        <td>Đĩa</td>
                        <td class="right">20.000</td>
                        <td class="right">20.000</td>
                        <td>
                            <input type="text" name="remarks1" class="remarksInput" /></td>
                        <td class="center">X</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lẩu bò</td>
                        <td class="right">1</td>
                        <td>Cái</td>
                        <td class="right">120.000</td>
                        <td class="right">120.000</td>
                        <td>
                            <input type="text" name="remarks2" class="remarksInput" /></td>
                        <td class="center">X</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Đũa</td>
                        <td class="right">3</td>
                        <td>Đôi</td>
                        <td class="right">5.000</td>
                        <td class="right">15.000</td>
                        <td>
                            <input type="text" name="remarks3" class="remarksInput" /></td>
                        <td class="center">X</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="8"><a href="#" id="addProduct">+</a></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="row">
            <div class="two columns push_eight right">Total:</div>
            <div class="two columns right">155.000 VNĐ</div>
        </div>
        <div class="row">
            <div class="two columns push_eight right">Service Fee:</div>
            <div class="two columns right">0 VNĐ</div>
        </div>
        <div class="row">
            <div class="two columns push_eight right">Tax (10%):</div>
            <div class="two columns right">15.500 VNĐ</div>
        </div>
        <div class="row">
            <div class="two columns push_eight right">Total Amount:</div>
            <div class="two columns right border-top">170.500 VNĐ</div>
        </div>
    </div>
    @Html.Partial("_SearchProductPopup", new SearchPopupModel { PopupId = "pdtPopup", PopupTitle = "Search Product" })

    <script>
        $(document).ready(function () {
            $('div.split-pane').splitPane();
            $('#tablelist').tabs();
            $("#addProduct").click(function () {
                var product = new Popup("pdtPopup", "@SearchPopupUrl.ProductsForCashier", onSelectProduct);
                product.OpenPopup();
                return false;
            });

            GetTablesByAreaID(1);
        });

        function onSelectProduct(e) {
            var id = e.target.id;
            var qty = $(e.target).parent().prev().find('input[id^="qty"]').val();
            $.ajax({
                type: 'POST',
                url: "/Cashier/SelectProduct",
                data: { tagId: id, quantity: qty }
            }).done(function (data) {
                var count = $('#order .tbContent tr').length;
                data.idx = count + 1;

                $('#pdt-tmpl').tmpl(data).appendTo('#order .tbContent');
            });
        }

        function GetTablesByAreaID(areaID) {
            $.ajax({
                type: 'POST',
                url: "/Cashier/GetTablesByAreaID",
                dataType: 'json',
                data: { areaID: areaID }
            }).done(function (data) {
                $('#table-tmpl').tmpl(data).appendTo('#area-' + areaID);
            });
        }
    </script>
</div>
